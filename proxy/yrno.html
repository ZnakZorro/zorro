<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>yrnoProxa</title>  
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="#008">
   <style>   
      body {font:normal Verdana 14pt;}
      .wrapper {margin:0; padding:0;}
      .container {margin:0.2em; padding:0.2em;}
   </style>
  <script>
    class Proxa {
         constructor(obj) {
           this.obj = obj;
         }
         /*get obj() {
             return this.obj();
        }*/
        // Method
        test() {
          return this.obj;
        }      
    }    
  </script>
</head>

<body>
    <div class="wrapper">       
        <div class="container">
          <h3>yrnoProxa <span class="watch" id="foo">foo</span></h3>
            czas: <span class="watch" id="bar">bar</span><br />
            temp: <span class="watch" id="miu">miu</span><br />
            wind : <span class="watch" id="win">miu</span><br />
            press: <span class="watch" id="prs">prs</span><br />
            rain1 : <span class="watch" id="ra1">ra1</span><br />
            rain6 : <span class="watch" id="ra6">ra1</span><br />
            rain12: <span class="watch" id="ra12">ra1</span><br />
            <hr />

            czas: <span class="watch" id="bar1">bar</span><br />
            temp: <span class="watch" id="miu1">miu</span><br />
            wind : <span class="watch" id="win1">miu</span><br />
            press: <span class="watch" id="prs1">prs</span><br />
            rain1 : <span class="watch" id="ra11">ra1</span><br />
            rain6 : <span class="watch" id="ra61">ra1</span><br />
            rain12: <span class="watch" id="ra121">ra1</span><br />            
        </div>
       <button onclick="change()">YRNO</button>
    </div>

<script>
const xtx=()=>(Math.random() + 1).toString(36).substring(2);

var watchOBJ = {}

const wOBJ = new Proxa(watchOBJ);
console.log(wOBJ.test())

var proxyOBJ = new Proxy(watchOBJ, {
  get: function(target, prop) {
    //console.log({ type: 'get', target, prop });    
    return Reflect.get(target, prop);
  },
  set: function(target, prop, value) {
    //console.log(`${prop} set from ${target[prop]} to ${value}`);    
    //console.log({ type: 'set', target, prop, value });
    target[prop] = value;
    document.getElementById(prop).innerHTML=watchOBJ[prop];
    return Reflect.set(target, prop, value);
  }
});

const getCzas=(time)=>{
    let timeFrom  = (new Date(time)).getTime()
    let czas = (new Date(timeFrom)).toLocaleString('pl-PL');
    return czas;
}
const change=()=>{
   let u = 'https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=53.3788&lon=14.666&altitude=15';
   fetch(u)
   .then(r => {return r.json()})
   .then(obj => {
      console.log(obj)
      proxyOBJ.foo = getCzas(obj.properties.meta.updated_at);
      let data = obj.properties.timeseries;      
      console.log(data)
      proxyOBJ.bar = getCzas(data[0].time);
      
      let dane = data[0].data.instant.details
      console.log(dane)
      proxyOBJ.miu = dane.air_temperature+"&deg;C";
      proxyOBJ.win = dane.wind_speed+"m/s";
      proxyOBJ.prs = dane.air_pressure_at_sea_level+"mmHg";
      proxyOBJ.ra1  = data[0].data.next_1_hours.details.precipitation_amount+"mm";
      proxyOBJ.ra6  = data[0].data.next_6_hours.details.precipitation_amount+"mm";
      proxyOBJ.ra12 = "0mm"
      if(data[0].data.next_12_hours.details?.precipitation_amount)
          proxyOBJ.ra12 = data[0].data.next_12_hours.details?.precipitation_amount+"mm";


      dane = data[1].data.instant.details
      console.log(dane)
      proxyOBJ.bar1 = getCzas(data[1].time);
      proxyOBJ.miu1 = dane.air_temperature+"&deg;C";
      proxyOBJ.win1 = dane.wind_speed+"m/s";
      proxyOBJ.prs1 = dane.air_pressure_at_sea_level+"mmHg";
      proxyOBJ.ra11  = data[1].data.next_1_hours.details.precipitation_amount+"mm";
      proxyOBJ.ra61  = data[1].data.next_6_hours.details.precipitation_amount+"mm";
      proxyOBJ.ra121 = "0mm"
      if(data[1].data.next_12_hours.details?.precipitation_amount)
          proxyOBJ.ra121 = data[0].data.next_12_hours.details?.precipitation_amount+"mm";


   }).catch(e => {console.log(e)})
    console.log(watchOBJ)    
}

document.addEventListener("DOMContentLoaded",function(){
  document.querySelectorAll(".watch").forEach((el)=>watchOBJ[el.id]="");

  change();
  setInterval(change,(30*60*1000));
});

</script>
    
</body>
</html>
