<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>#hash</title>  
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="#008">
   <link rel="shortcut icon" type="image/svg+xml" size="any" href="../../img/dom.svg"> 
   <link rel="manifest" href="../../zorro.web.json"> 
   <link rel="stylesheet" href="../../css/style.css" />
   <link rel="stylesheet" href="../../css/all.css" />
   <style>   
      .smally {font-size:12pt; margin-left:0.5em;}
      #result ul {margin-left:1.25em;}
      .title {color:darkred;}
   </style>
   <script src="./add/md5.min.js"></script>
   
<script>
   
const analize=()=>{
   let keys = {}
   let arrTiitle   = [];
   let arrHeadline = [];
   let arrRecipe   = [];
   let content  = document.getElementById("result");
   let titles   = content.querySelectorAll("h3");
   titles.forEach((t)=>{
      let arr = t.textContent.split(",");
      arr.forEach((a,i)=>{
         arr[i]=a.trim(); 
         arr[i]=a.toLowerCase();
         console.log(a.trim(), a.trimStart());
         
      })
      //arr.filter(a => a.trim().toLowerCase());
      arr.forEach((a)=>{
         if (!keys[a])  keys[a]=1; else keys[a]++;
      })
      console.log("titles=",arr);
   })
   console.log("keys=",keys);
   let descript = content.querySelectorAll("p");
   let recipt   = content.querySelectorAll("ul");
   
   
   titles.forEach((h3,i)=>{
      let id = "sok"+i;
      h3.id = id;
      h3.classList.add("title");

   })
   let uls = content.querySelectorAll("ul");
   console.log(uls);
   let ps = content.querySelectorAll("p");
   console.log(ps);
   uls.forEach((u)=>{
     u.insertAdjacentHTML("afterend", "<hr />");//"</div><div class='doc'>");
      //beforebegin afterbegin beforeend afterend 
   });
   let divs = content.querySelectorAll("div");
   divs.forEach((d,i)=>{
      console.log(d);
   })
}


const hasz=(hash)=>{
   hash = hash.trim();
   if (!hash) return;
   let token = md5(hash.toLowerCase());
   input.value = token;
}      
const gogogo=(hash)=>{
   hash = hash.trim();
   if (!hash) return;
   let token = md5(hash.toLowerCase());
   let uri = "https://raw.githubusercontent.com/ZnakZorro/zorro/main/app/hash/_/"+token+".html"
   console.log(hash,token,uri);
   fetch(uri)
   .then(r => {return r.text()})
   .then(o => {
      document.getElementById("result").innerHTML = "<div class='doc'>"+o+"</div>";
      document.getElementById("edit").innerHTML = `<button onclick='edit("${uri}")'>edit</button>`;
      analize();
   })
   .catch(e => {console.log(e)})
//onclick="result.value=md5(input.value);return false"
}

const edit=(url)=>{   
   url = 'https://znakzorro.github.io/zorro/app/EDEK/?url='+url;
   window.open(url,"_self");  
}
document.addEventListener("DOMContentLoaded",function(){
  //document.getElementById("info").textContent = "info";
 
});

</script>
          
</head>

<body>
    <div class="wrapper">
        <app-menu title="#hash" name="ZnakZorro" link="../../"></app-menu>
        <script src="../../appMenu.js"></script>
       
        <div class="container">
           <!--a href="./hash.html" class="btn red">#Hash</a>
           <a href="./md5.html" class="btn red">#md5</a-->
           <button onclick="hasz(input.value);return false">#hash</button>
               
       </div>
       
       
    </div><!-- wraper-->

<div class="wrapper">
   <div class="container">
      
      <form style="display:inline">
            <p>
              <input id="input" style="min-width:17em; font-size: 14pt;" />
              <button class="red" type="submit" id="calculate" onclick="gogogo(input.value);return false">Go</button>               
            </p>
          </form>
      
      
         
      
   </div>
</div>
   
<div class="wrapper">
   <div class="container">
   <div id="edit" class="smally"></div>   
   <div id="result" class="smally"></div>   
   </div>
</div>
   
</body>
</html>
