<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>SNIPET 3</title>
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="orange">
   <link rel="shortcut icon" type="image/svg+xml" size="any" href="../../img/dom.svg"> 
   <link rel="manifest" href="../../zorro.web.json">   
   <link rel="stylesheet" href="../../css/style.css" />
   <link rel="stylesheet" href="../../css/all.css" />
   
<style>
   h3,h2 {font-size:1.2em}
   ul,ol {margin-left: 1.5em;}
   ul>p {margin:0em;}
.js, .html, .md, .code {
    font-family: monospace;
    background: white;
    border: 1px solid gray;
    padding: 0.5em;
    font-size: xx-small;
    white-space: break-spaces;
    line-break: anywhere;
}
   .txt,.text {
      font-family: inherit;
      font-size: medium;
      line-break: inherit;
      white-space: inherit;
   }
   .text *  {padding-bottom:0.1em;}
   div#klawisze{background:#fff;}
   div#klawisze>div {box-shadow: 0px 4px 8px rgb(0 0 0 / 20%);padding:0.25em;}
   div#klawisze>div>span {display:inline-block; min-width:3.0em;font-weight: bold;}
   /*div#klawisze>div>button {background-color: #777;color: white;}*/
</style>
   <script src="../../js/FileSaver.min.js"></script>
   <script src="../../js/edit.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
   <script src="./dir.js"></script>
   
<script>
   console.log(dir);
const snipARR = [
   {n:"Gramofon",        f:"dom",     v:"html",  u:"gramofon.htm"},
   {n:"Szlif",           f:"dom",     v:"html",  u:"szlif.htm"},
   {n:"Ekspres",         f:"dom",     v:"txt",   u:"expres.txt"},
   {n:"Nalewki",         f:"dom",     v:"txt",   u:"nalewki.txt"},
   {n:"index",           f:"html",    v:"code",  u:"index.html"},
   {n:"git",             f:"html",    v:"code",  u:"git.html"},
   {n:"fetch",           f:"js",      v:"code",  u:"fetch.js"},
   {n:"createElement",   f:"js",      v:"code",  u:"createElement.js"},
   {n:"active",          f:"js",      v:"code",  u:"active.js"},
   {n:"dom",             f:"js",      v:"code",  u:"domReady.js"},
   {n:"param",           f:"js",      v:"code",  u:"parameters.js"},
   {n:"BorÃ³wki",         f:"580",     v:"txt",   u:"borowki.txt"},
   {n:"Ciasto",          f:"kuchnia", v:"txt",   u:"ciasto.txt"},
   {n:"Piernik",         f:"kuchnia", v:"html",  u:"Piernik.htm"},
   {n:"Lody",         f:"kuchnia",     v:"md",   u:"lody.md"},
   {n:"Lody2",         f:"kuchnia",     v:"md",   u:"lody2.md"},
   {n:"md",         f:"md", v:"md",  u:"md.md"},
   
   
];
let actualDOC=0;
let mainFolders = [];


const showMainFolders=()=>{
      snipARR.forEach((o)=>{
         mainFolders.push(o.f);
      });  
      mainFolders = [...new Set(mainFolders)]
      mainFolders.forEach((f,i)=>{
         document.getElementById("mainFolders").innerHTML += `<button class='btn c${(i+10)%10}' onclick='mainFoder("${f}",this)'>${f.toUpperCase()}</button>`;    
      })
}   


const mainFoder=(dir,ten)=>{
   document.querySelectorAll("#mainFolders button").forEach(b=>b.classList.remove("active"));
   ten.classList.add("active");
   //console.log(dir);
   let arr=[];
   snipARR.forEach((z,i)=>{
      z.i=i;
      if (z.f===dir){
         arr.push(z);  
      }
   })
   //console.log(arr);
   let html = "<span>"+dir.toUpperCase()+": </span>";
   arr.forEach((a,i)=>{
      //console.log(a);
      html += `<button class="c${i%10}" data-index="${a.i}" onclick='ShowNow(this,"${a.f}/${a.u}",${a.i})'>${a.n}</button>`;
   });
   document.getElementById("klawisze").innerHTML = "<div>"+html+"</div>"; 
   document.querySelector("#klawisze button").click();
}


const fireFirsStart=()=>{
    document.querySelector("#mainFolders button").click();
    //setTimeout(()=>{
        document.querySelector("#klawisze button").click();
    //},100)
    
} 

//---dom ready--------------------------------
document.addEventListener("DOMContentLoaded",function(){
      //showButtonsByFolders();
      showMainFolders();
      fireFirsStart();
})
//---DOM READY----------------------------------   
  

const getCode=(url,callback)=>{
   fetch(url)
  .then(ret => {return ret.text()})
  .then(code => {
      callback(code);
   }).catch(e => {console.log(e)})
}   

const getLocalURL=url=>{
   let o = snipARR[actualDOC];
   url = (url) ? url : o.f+"/"+o.u;
   return url;
}
const getURL=url=>'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
 
const edit=(url)=>{   
   url = getLocalURL(url);
   console.log(77,url);
   let exurl = getURL(url);//'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
   window.open(exurl,"_self");  
}

const show=(url)=>{
   let code = document.getElementById("snipet").textContent;
   url = getLocalURL(url);
   console.log("show==",code);   
   
}

const save=(url)=>{
   let code = document.getElementById("snipet").textContent;
   //console.log("save==",code);
   let filename = snipARR[actualDOC].u;
   if (!filename) {alert("no file"); return;}
   let ext = filename.split(".")[1];
   //console.log(96,ext,filename);
   let mime = "text/plain";
   if (ext==="html")   mime = "text/html";
   if (ext==="htm")   mime = "text/html";
   if (ext==="js")     mime = "text/javascript";
   if (ext==="json")   mime = "application/json";

   var blob = new Blob([code], {type: mime+";charset=utf-8"});
   saveAs(blob, filename); 
}



/*qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq*/   
const ShowNow=(ten,url,i)=>{
      let snipet = document.getElementById("snipet");
      snipet.textContent = "";
      actualDOC = i;
      //console.log("117 actualDOC=",actualDOC,snipARR[actualDOC],ten);
      document.querySelectorAll("#klawisze button").forEach(b=>b.classList.remove("active"));
      //ten.classList.add("active");
      let ext = snipARR[actualDOC].u.split(".")[1];
      //console.log("128",ext);
      let formatowanie = false;
      console.log(snipARR[actualDOC].v);
      if (ext==="txt" || ext==="htm") {
            snipet.classList.add("text");
      }
      else  snipet.classList.remove("text");
      formatowanie = (ext==="txt");// || ext ==="htm") ;
      
   
      fetch(url)
        .then(ret => {return ret.text()})
        .then(code => {
            console.log("194 ext=",ext);
            console.log("195 ver=",snipARR[actualDOC].v);
            code = formatTXT2HTMLext(code,ext);
            if (formatowanie){
                  snipet.innerHTML =  code;
            } else { 
               if      (ext==="htm" || ext==="md") snipet.innerHTML   = code;
               else                                snipet.textContent = code;
            }
            snipet.classList.add(ext);
            ten.classList.add("active");
      })
        .catch(e => {console.log(e)})   
} 

document.addEventListener("DOMContentLoaded",function(){
    let first = document.querySelector("#klawisze button");
    if (first) first.click(); 
});
   
/*  SHARE  */      
      const sharego=()=>{     
            let title = snipARR[actualDOC].n+" - "+snipARR[actualDOC].u;
            let text  = document.getElementById("snipet").innerHTML;
            if (navigator.share) {
              navigator
                .share({
                  title: title,
                  text: text,
                  url: "https://znakzorro.github.io/zorro/app/snipet/",
                })
                .then(() => console.log("Successful share"))
                .catch((error) => console.log("Error sharing", error));
            } else {
              console.error("Browser doesn't support Web Share API");
              document.getElementById("info").innerHTML = "Browser doesn't support Web Share API";
            }      
       }
/*  SHARE  */      
    
   
   
</script>
</head>

<body>
    <div class="wrapper">
        <app-menu title="SNIPET" name="ZnakZorro" link="../../"></app-menu>
        <script src="../../appMenu.js"></script>
       <div class="info message" id="info"></div>
        <div class="container klawisze" id="mainFolders"></div>
        <div class="container" id="klawisze"></div>
        <div class="container" id="edits">
            <button class="adm0" onclick="save()">save</button>
            <button class="adm1" onclick="show()">show</button>
            <button class="adm2" onclick="edit()">edit</button>
        </div>
       
        <div class="container code" id="snipet" contenteditable="true"></div>
       
       
         <div class="container">
               <button class="btn big long c21" onclick="sharego()">share</button>               
         </div>            
       
    </div>


   
<div id="batony"></div>
<script>
    //for (let n=0; n<22; n++) document.getElementById("batony").innerHTML += `<button class="c${n} btn">c${n}</button>`;
</script>
   
</body>

</html>
