<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>SNIPET 3</title>
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="orange">
   <link rel="shortcut icon" type="image/svg+xml" size="any" href="../../img/dom.svg"> 
   <link rel="manifest" href="../../zorro.web.json">   
   <link rel="stylesheet" href="../../css/style.css" />
   <link rel="stylesheet" href="../../css/all.css" />
   
<style>
   h3,h2 {font-size:1.2em}
.code {
    font-family: monospace;
    background: white;
    border: 1px solid gray;
    padding: 0.5em;
    font-size: xx-small;
    white-space: break-spaces;
    line-break: anywhere;
}
   .text {
      font-family: inherit;
      font-size: medium;
      line-break: inherit;
      white-space: inherit;
   }
   .text *  {padding-bottom:0.1em;}
   div#klawisze>div {box-shadow: 0px 4px 8px rgb(0 0 0 / 20%);padding:0.25em;}
   div#klawisze>div>span {display:inline-block; min-width:3.0em;font-weight: bold;}
   /*div#klawisze>div>button {background-color: #777;color: white;}*/
</style>
   <script src="../../js/FileSaver.min.js"></script>
<script>
const snipARR = [
   {n:"index",           f:"html",    u:"index.html"},
   {n:"git",             f:"html",    u:"git.html"},
   {n:"fetch",           f:"js",      u:"fetch.js"},
   {n:"createElement",   f:"js",      u:"createElement.js"},
   {n:"active",          f:"js",      u:"active.js"},
   {n:"dom",             f:"js",      u:"domReady.js"},
   {n:"Ekspres",         f:"dom",     u:"expres.txt"},
   {n:"Nalewki",         f:"dom",     u:"nalewki.txt"},
   {n:"BorÃ³wki",         f:"580",     u:"borowki.txt"},
   {n:"Ciasto",          f:"kuchnia", u:"ciasto.txt"},
   
];
let actualDOC=0;
let mainFolders = [];


const showMainFolders=()=>{
      snipARR.forEach((o)=>{
         mainFolders.push(o.f);
      });  
      mainFolders = [...new Set(mainFolders)]
      mainFolders.forEach((f,i)=>{
         document.getElementById("mainFolders").innerHTML += `<button class='btn c${(i+10)%10}' onclick='mainFoder("${f}",this)'>${f}</button>`;    
      })
}   


const mainFoder=(dir,ten)=>{
   document.querySelectorAll("#mainFolders button").forEach(b=>b.classList.remove("active"));
   ten.classList.add("active");
   //console.log(dir);
   let arr=[];
   snipARR.forEach((z,i)=>{
      z.i=i;
      if (z.f===dir){
         arr.push(z);  
      }
   })
   //console.log(arr);
   let html = "<span>"+dir+": </span>";
   arr.forEach((a,i)=>{
      //console.log(a);
      html += `<button class="c${i%10}" data-index="${a.i}" onclick='ShowNow(this,"${a.f}/${a.u}",${a.i})'>${a.n}</button>`;
   });
   document.getElementById("klawisze").innerHTML = "<div>"+html+"</div>"; 
   document.querySelector("#klawisze button").click();
}


const fireFirsStart=()=>{
    document.querySelector("#mainFolders button").click();
    //setTimeout(()=>{
        document.querySelector("#klawisze button").click();
    //},100)
    
} 

//---dom ready--------------------------------
document.addEventListener("DOMContentLoaded",function(){
      //showButtonsByFolders();
      showMainFolders();
      fireFirsStart();
})
//---DOM READY----------------------------------   
  

const getCode=(url,callback)=>{
   fetch(url)
  .then(ret => {return ret.text()})
  .then(code => {
      callback(code);
   }).catch(e => {console.log(e)})
}   

const getLocalURL=url=>{
   let o = snipARR[actualDOC];
   url = (url) ? url : o.f+"/"+o.u;
   return url;
}
const getURL=url=>'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
 
const edit=(url)=>{   
   url = getLocalURL(url);
   console.log(77,url);
   let exurl = getURL(url);//'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
   window.open(exurl,"_self");  
}

const show=(url)=>{
   let code = document.getElementById("snipet").textContent;
   url = getLocalURL(url);
   console.log("show==",code);   
   
}

const save=(url)=>{
   let code = document.getElementById("snipet").textContent;
   //console.log("save==",code);
   let filename = snipARR[actualDOC].u;
   if (!filename) {alert("no file"); return;}
   let ext = filename.split(".")[1];
   //console.log(96,ext,filename);
   let mime = "text/plain";
   if (ext==="html")   mime = "text/html";
   if (ext==="js")     mime = "text/javascript";
   if (ext==="json")   mime = "application/json";

   var blob = new Blob([code], {type: mime+";charset=utf-8"});
   saveAs(blob, filename); 
}

const formatTXT=(code)=>{
   let arr = code.split("\n");
   if (arr[0]) arr[0] = "<h3>"+arr[0]+"</h3>";
   if (arr[1]) arr[1] = "<b>"+arr[1]+"</b>";
   if (arr[2]) arr[2] = "<b><i>"+arr[2]+"</i></b>";
   for (let i=1; i<arr.length-1; i++){
      arr[i] = arr[i].trim();
      if (arr[i] != "") arr[i] = "<p>"+arr[i]+"</p>";
      else              arr[i] = "<br />";
   }
   //console.log("aaaaaaa=",arr);
   return arr.join("\n");
}


/*qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq*/   
const ShowNow=(ten,url,i)=>{
      let snipet = document.getElementById("snipet");
      actualDOC = i;
      console.log("117 actualDOC=",actualDOC,snipARR[actualDOC],ten);
      document.querySelectorAll("#klawisze button").forEach(b=>b.classList.remove("active"));
      //ten.classList.add("active");
      let ext = snipARR[actualDOC].u.split(".")[1];
      console.log("128",ext);
      let formatowanie = false;
      if (ext==="txt") {
            snipet.classList.add("text");
            formatowanie = true;
      }
      else  snipet.classList.remove("text");
      
   
      fetch(url)
        .then(ret => {return ret.text()})
        .then(code => {
            if (formatowanie){
                  snipet.innerHTML = formatTXT(code);
            } else {       
               snipet.textContent = code;
            }
            ten.classList.add("active");
      })
        .catch(e => {console.log(e)})   
} 

document.addEventListener("DOMContentLoaded",function(){
    let first = document.querySelector("#klawisze button");
    if (first) first.click(); 
});
</script>
</head>

<body>
    <div class="wrapper">
        <app-menu title="SNIPET" name="ZnakZorro" link="../../"></app-menu>
        <script src="../../appMenu.js"></script>
       <div class="info message" id="info"></div>
        <div class="container klawisze" id="mainFolders"></div>
        <div class="container" id="klawisze"></div>
        <div class="container" id="edits">
            <button class="adm0" onclick="save()">save</button>
            <button class="adm1" onclick="show()">show</button>
            <button class="adm2" onclick="edit()">edit</button>
        </div>
       
        <div class="container code" id="snipet" contenteditable="true"></div>
       
       
         <div class="container">
               <button class="btn big long" onclick="sharego()">share</button>               
         </div>            
       
    </div>

   
<script>
   
     
      
      const sharego=()=>{      
            if (navigator.share) {
              navigator
                .share({
                  title: "Snipet ",
                  text: "Tekst snipeta",
                  url: "https://znakzorro.github.io/zorro/app/snipet/",
                })
                .then(() => console.log("Successful share"))
                .catch((error) => console.log("Error sharing", error));
            } else {
              console.error("Browser doesn't support Web Share API");
              document.getElementById("info").innerHTML = "Browser doesn't support Web Share API";
            }      
       }

      
      
      
</script>
   
<div id="batony"></div>
<script>
    for (let n=0; n<22; n++) document.getElementById("batony").innerHTML += `<button class="c${n} btn">c${n}</button>`;
</script>
   
</body>

</html>
