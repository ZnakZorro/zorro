<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>SNIPET 3</title>
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="gold">
   <link rel="shortcut icon" type="image/svg+xml" size="any" href="../../img/dom.svg"> 
   <link rel="manifest" href="../../zorro.web.json">   
   <link rel="stylesheet" href="../../css/style.css" />
   <link rel="stylesheet" href="../../css/all.css" />
   
<style>
   h3,h2 {font-size:1.2em}
.code {
    font-family: monospace;
    background: white;
    border: 1px solid gray;
    padding: 0.5em;
    font-size: xx-small;
    white-space: break-spaces;
    line-break: anywhere;
    display: flex;
}
   .text {
      font-family: inherit;
      font-size: medium;
      line-break: inherit;
   }
   div#klawisze>div {box-shadow: 0px 4px 8px rgb(0 0 0 / 20%);padding:0.25em;}
   div#klawisze>div>span {display:inline-block; min-width:3.0em;}
   /*div#klawisze>div>button {background-color: #777;color: white;}*/
</style>
   <script src="../../js/FileSaver.min.js"></script>
<script>
const snipARR = [
   {n:"index",           f:"html",   u:"index.html"},
   {n:"git",             f:"html",   u:"git.html"},
   {n:"fetch",           f:"js",     u:"fetch.js"},
   {n:"createElement",   f:"js",     u:"createElement.js"},
   {n:"active",          f:"js",     u:"active.js"},
   {n:"dom",             f:"js",     u:"domReady.js"},
   {n:"BorÃ³wki",             f:"580",     u:"borowki.txt"},
   {n:"Ekspres",             f:"dom",     u:"expres.txt"},
   {n:"Nalewki",             f:"dom",     u:"nalewki.txt"},
   
];
let actualDOC=0;
   
const showButtonsByFolders=()=>{
      let folders={}
      snipARR.forEach((o,i)=>{
         folders[o.f] = [];
      });
      snipARR.forEach((o,i)=>{
         let u = o.f+'/'+o.u;
         folders[o.f].push(`<button data-index="${i}" onclick='ShowNow(this,"${u}",${i})'>${o.n}</button>`);
      });
      for (const f in folders){
         let html = "<div><span>"+f+": </span>"+folders[f].join("")+"</div>";
         document.getElementById("klawisze").innerHTML += html;   
      }
}   

//---dom ready--------------------------------
document.addEventListener("DOMContentLoaded",function(){
      showButtonsByFolders();
})
//---DOM READY----------------------------------   
  

const getCode=(url,callback)=>{
   fetch(url)
  .then(ret => {return ret.text()})
  .then(code => {
      callback(code);
   }).catch(e => {console.log(e)})
}   

const getLocalURL=url=>{
   let o = snipARR[actualDOC];
   url = (url) ? url : o.f+"/"+o.u;
   return url;
}
const getURL=url=>'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
 
const edit=(url)=>{   
   url = getLocalURL(url);
   console.log(77,url);
   let exurl = getURL(url);//'https://znakzorro.github.io/zorro/app/EDEK/?url='+location.href+url;
   window.open(exurl,"_self");  
}

const show=(url)=>{
   let code = document.getElementById("snipet").textContent;
   url = getLocalURL(url);
   console.log("show==",code);   
   
}

const save=(url)=>{
   let code = document.getElementById("snipet").textContent;
   //console.log("save==",code);
   let filename = snipARR[actualDOC].u;
   if (!filename) {alert("no file"); return;}
   let ext = filename.split(".")[1];
   //console.log(96,ext,filename);
   let mime = "text/plain";
   if (ext==="html")   mime = "text/html";
   if (ext==="js")     mime = "text/javascript";
   if (ext==="json")   mime = "application/json";

   var blob = new Blob([code], {type: mime+";charset=utf-8"});
   saveAs(blob, filename); 
}

const formatTXT=(code)=>{
   let arr = code.split("\n");
   arr[0] = "<h3>"+arr[0]+"</h3>";
   for (let i=1; i<aa.length-2; i++){
      arr[i] = "<h3>"+arr[i]+"</h3>";
   }
   console.log(arr);
   return arr.join("\n");
}


/*qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq*/   
const ShowNow=(ten,url,i)=>{
      actualDOC = i;
      console.log("117 actualDOC=",actualDOC,snipARR[actualDOC],ten);
      document.querySelectorAll("#klawisze button").forEach(b=>b.classList.remove("active"));
      //ten.classList.add("active");
      let ext = snipARR[actualDOC].u.split(".")[1];
      console.log("128",ext);
      let formatowanie = false;
      if (ext==="txt") {
            document.getElementById("snipet").classList.add("text");
            formatowanie = true;
      }
      else  document.getElementById("snipet").classList.remove("text");
      
   
      fetch(url)
        .then(ret => {return ret.text()})
        .then(code => {
            if (formatowanie){
                  document.getElementById("snipet").innerHTML = formatTXT(code);
            } else document.getElementById("snipet").textContent = code;
            ten.classList.add("active");
      })
        .catch(e => {console.log(e)})   
} 

document.addEventListener("DOMContentLoaded",function(){
    let first = document.querySelector("#klawisze button");
    if (first) first.click(); 
});
</script>
</head>

<body>
    <div class="wrapper">
        <app-menu title="SNIPET" name="ZnakZorro" link="../../"></app-menu>
        <script src="../../appMenu.js"></script>
       
        <div class="container" id="klawisze"></div>
       <div class="container" id="edits">
            <button class="adm red" onclick="save()">save</button>
            <button class="adm" onclick="show()">show</button>
            <button class="adm" onclick="edit()">edit</button>
            <hr />
       </div>
       
        <div class="container code" id="snipet" contenteditable="true"></div>
    </div>
  
  </body>
</html>
