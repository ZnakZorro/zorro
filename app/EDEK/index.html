<!DOCTYPE html>
<html lang="pl">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <meta http-equiv="x-ua-compatible" content="ie=edge" />
   <title>EDEK</title>
   <meta name="HandheldFriendly" content="true">
   <meta name="mobile-web-app-capable" content="yes"> 
   <meta name="theme-color" content="#214960">
   <link rel="shortcut icon" type="image/svg+xml" size="any" href="../../img/dom.svg"> 
   <link rel="manifest" href="../../zorro.web.json"> 
   <style>
    .ck.ck-editor__main>.ck-editor__editable:not(.ck-focused) {
        min-height: 5em;
    }
    #editor {min-height: 5em;}
    div.keys {padding:0.5em;}
    div.keys span {padding:0 1em;}
    div.keys button {margin:0.3em;}
    div.keys {padding:0.5em;}
   </style>
   <script src="https://cdn.ckeditor.com/ckeditor5/34.2.0/classic/ckeditor.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
   <script>




   </script>

</head>
<body>
    <div class="keys">
        <span>EDEK</span>
        
        <button id="saveButton">save</button>
	    <button onclick="submitHTML()">submitHTML()</button>
	    
        
    </div>
    <div id="editor">
        <p></p>
    </div>
    <script>
        ClassicEditor
            .create( document.querySelector( '#editor' ) )
            .catch( error => {
                console.error( error );
            } );


    document.getElementById("saveButton").addEventListener('click', function() {
       //let date = (new Date()).toLocaleString().replaceAll(",","").replaceAll(".","-").replaceAll(":","-").replaceAll(" ","-");
       //let date = (new Date()).toLocaleString().replace(/[ .,:]/g,"-").replace("--","-");
       let date = (new Date()).toLocaleString().replace(/[^\w\s]| /gi, '_').replace("__","_");
       
       let nameOfFile = "edek-"+date+".html";
       let filename = prompt("Nazwa pliku",nameOfFile);
       console.log(filename);
       
       
        let content = document.querySelector("div.ck-content").innerHTML;
        var blob = new Blob([content], {type: "text/plain;charset=utf-8"});
        saveAs(blob, filename);

    })

    </script>
   
   
   
 <script>
 const $=(y)=>document.querySelector(y);
const $$=(y)=>document.querySelectorAll(y);
   
function getTitle(html){
   let titleMatch = new RegExp("<h1[^>]*>(.*?)<\/h1>");
   let res = html.match(titleMatch);
   let title = null;
   if (res && res[1]) title = res[1];
   if (title){
      title  = title.substring(0,63);
      title = title.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g,'_');  
      var dict = {"ą":"a","ć":"c","ę":"e","ó":"o","ł":"l","ń":"n","ż":"z","ź":"z","Ą":"A","Ć":"C","Ę":"E","Ó":"O","Ł":"L","Ń":"N","Ż":"Z","Ź":"Z"}
      title = title.replace(/[^\w ]/g, function(char) {return dict[char] || char;});	
   }
   return title;
}   
   
function submitHTML(){   
   let html   = document.getElementById('editor').innerHTML;
   let title  = getTitle(html) || 'htmlWWW';
   let header = '<html lang="pl">\n<head>\n<meta charset="utf-8"><title>'+title+'</title>\n</head>\n<body>\n';
   let footer = '\n</body>\n</html>\n';
       html = html.replace(/\<p/gi,'\n<p');
       html = html.replace(/\<h/gi,'\n<h');
       html = html.replace(/\<div/gi,'\n<div');
       html = header + html + footer;
   
         var newBlob = new Blob([html], {type: "text/html"})
         if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            window.navigator.msSaveOrOpenBlob(newBlob);
            return;
         } 

     const data = window.URL.createObjectURL(newBlob);
     var link = document.createElement('a');
     link.href = data;
     link.download = title+".html";
     link.click();
     setTimeout(function(){
       window.URL.revokeObjectURL(data);
     },100)
}
	
   </script>
   
</body>
</html>
