<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/svg+xml" size="any" href="./../img/dom.svg"> 
   <link rel="manifest" href="./../zorro.web.json"> 
<title>git::RSS</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#db5945">
<style>
    body,button {
    font-family: 'Roboto', "Verdana", sans-serif;
    font-size: 14pt;
    font-weight: 300;
    line-height: 1.3;
    }
    button {margin:0.15em; padding:0.25em;border-radius: 0.5em;}

    a {text-decoration: none;}
    p {margin:0;}
    h4 {margin: 0.5em 0 0 0;}
    article {display:grid; margin-bottom: 0.5em;}
    article img {width:128px;}
</style>


<script>

const rssTXT =`
Szczecin - https://rss.gazeta.pl/pub/rss/szczecin.xml
Wyborcza - https://rss.gazeta.pl/pub/rss/najnowsze_wyborcza.xml
Kraj24 - https://tvn24.pl/wiadomosci-z-kraju,3.xml
Swiat - https://www.polsatnews.pl/rss/swiat.xml
Polityka - https://www.polityka.pl/rss/podcasts.xml?list=2433
Gospodarka - https://www.bankier.pl/rss/wiadomosci.xml
Internet - https://www.mbaportal.pl/rss/article
Gry - https://gamerweb.pl/feed/
Nauka - https://naukawpolsce.pap.pl/all/rss.xml
Sport - https://www.polsatsport.pl/rss/wszystkie.xml
`;   

let rssARR = rssTXT.trim().split("\n");
let rssOBJ =[];
for (r of rssARR){
    let a = r.split(" - ");
    rssOBJ.push({"n":a[0],"u":a[1]});
}
console.log(rssOBJ);

document.addEventListener("DOMContentLoaded",function(){
    let html = "";
    for (o of rssOBJ){
        html += `<button onclick='readRSS("${o.u}")'>${o.n}</button>`;
    }
    document.getElementById("klawisze").innerHTML += html;
    readRSS();
});

 function htmlencode(str) {
    return str.replace(/[&<>"']/g, function($0) {
        return "&" + {"&":"amp", "<":"lt", ">":"gt", '"':"quot", "'":"#39"}[$0] + ";";
    });
} 

  function decodeHTMLEntities (str) {
    if(str && typeof str === 'string') {
      // strip script/html tags
      str = str.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi, '');
      str = str.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi, '');
      //element.innerHTML = str;
      //str = element.textContent;
      //element.textContent = '';
    }

    return str;
  }
  
const decodeHTML=(str)=> {
    if(str && typeof str === 'string') {
        str = str.replaceAll("&gt;",">");
        str = str.replaceAll("&lt;","<");
        str = str.replaceAll("�","ó");
    }
    return str;
  }


const readRSS=(url="https://rss.gazeta.pl/pub/rss/szczecin.xml",ten=null)=>{
    console.log("uuuuuuuu=",url)
    console.log(ten)
    fetch(url)
    .then(response => response.text())
    .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
    .then(data => {
        console.log(data);
        const title = data.querySelector("channel title").textContent;
        const link = data.querySelector("channel link").textContent;
        console.log(title,link)
        const items = data.querySelectorAll("item");
        let html = `<h3><a href="${link}" target="_blank">${title}</a></h3>`;
        items.forEach((el,i) => {
            let j=i+1;
            if (i>5) return;
            //console.log(el)
            //console.log(el.querySelector("description").innerHTML)
            let czas = (new Date(el.querySelector("pubDate").textContent)).toLocaleString('pl-PL');
            let desc = decodeHTML(el.querySelector("description").innerHTML);
            console.log(i,desc)
            //document.getElementById("txt").value += desc+"\n\n"
            //decodeURIComponent(el.querySelector("description").innerHTML)
        html += `
            <article>
            <!--img src="${el.querySelector("link").innerHTML}/image/large.png" alt=""-->
                <h4> 
                    <a href="${el.querySelector("link").innerHTML}" target="_blank" rel="noopener">
                    ${j}. ${decodeHTML(el.querySelector("title").innerHTML)}
                    </a>
                </h4>
                <p><span>${czas}</span><br />
                ${desc}</p>
            </article>
        `;
        });
        //document.body.insertAdjacentHTML("beforeend", html);
        document.getElementById("gazeta").innerHTML = html;
    });
}

</script>
</head>

<body>
<app-menu title="RSS" name="ZnakZorro" link="../../"></app-menu>
<script src="../../appMenu.js"></script>
<div id="klawisze" class="klawisze">
</div>
<div id="gazeta"></div>

</body>
</html>
